#!/usr/bin/env python
# coding=utf-8
import os
import re

def getCpu():
    li = os.popen("adb shell top -m 100 -n 1 -s cpu").readlines()
    name = "com.hellotalk"
    for line in li:
        if re.findall(name,line):
            cuplist = line.split(" ")
            if cuplist[-1].strip() == 'com.hellotalk':
                while '' in cuplist:       # 将list中的空元素删除
                    cuplist.remove('')
                print cuplist
                print float(cuplist[2].strip('%'))
                return float(cuplist[2].strip('%')) #去掉百分号，返回一个float


def getTotalPss():
    lines = os.popen("adb shell dumpsys meminfo com.hellotalk ").readlines()
    total = "TOTAL"
    for line in lines:
        if re.findall(total, line): # 找到TOTAL 这一行
            lis = line.split(" ")  #将这一行，按空格分割成一个list
            while '' in lis:       # 将list中的空元素删除
                lis.remove('')
            print lis
            print lis[1]
            return lis[1] #返回总共内存使用

def writ_pss(string ,wirt):
    if wirt == 1:
        wir = 0
        errfile = "%s/error.csv" % (os.getcwd())
        if not os.path.exists(errfile):
            wir = 1
        fr = open (errfile, 'a')
        if wir == 1:
            fr.write ("time  pss  cpu%")
            fr.write ('\n')
        fr.write(string)
        fr.close()
#writ_pss("108, 119, 111, 112, 112, 112, 105, 105, 105, 105, 105, 105, 98, 98, 89, 89, 105, 108, 112, 113, 113, 113, 115, 114, 113, 115, 115, 116, 90, 89, 90, 88, 88, 90, 88, 89, 131, 137, 130, 129, 130, 131, 129, 110, 111, 128, 130, 131, 157, 165, 184, 183, 182, 182, 182, 181, 190, 240, 245, 247, 250, 210, 211, 206, 206, 233, 206, 198, 200, 201, 201, 201, 201, 202, 201, 203, 202, 193, 197, 203, 217, 216, 218, 231, 231, 231, 231, 231, 231, 231, 231, 231, 220, 209, 199, 199, 162, 161, 161, 161, 154, 154, 154, 154, 154, 155, 155, 155, 155, 155, 155, 154, 183, 183, 183, 183, 183, 183, 165, 205, 203, 203, 203, 203, 204, 204, 204, 205, 202, 202, 202, 202, 202, 192, 193, 208, 211, 212, 213, 213, 212, 212, 195, 212, 211, 211, 211, 213, 213, 213, 212, 211, 211, 212, 188, 162, 162, 162, 162, 162, 193, 204, 196, 196, 196, 196, 189, 178, 191, 192, 194, 196, 195, 196, 197, 167, 169, 168, 168, 168, 204, 199, 197, 196, 189, 172, 173, 174, 173, 172, 170, 187, 222, 194, 208, 208, 208, 209, 207, 233, 268, 272, 271, 271, 224, 225, 225, 226, 240, 240, 225, 225, 229, 229, 228, 228, 228, 229, 228, 227, 227, 220, 241, 242, 242, 247, 256, 256, 255, 255, 255, 255, 255, 255, 232, 231, 183, 183, 182, 182, 182, 176, 177, 176, 177, 177, 177, 177, 176, 176, 176, 176, 176, 176, 176, 176, 203, 204, 221, 227, 227, 227, 228, 234, 234, 243, 249, 249, 239, 239, 238, 239, 238, 239, 239, 239, 239, 240, 253, 286, 242, 234, 241, 234, 233, 233, 233, 284, 284, 284, 290, 289, 289, 243, 268, 280, 249, 249, 249, 250, 251, 252, 252, 252, 252, 253, 238, 235, 272, 253, 252, 252, 253, 265, 266, 256, 256, 264, 271, 262, 277, 277, 277, 276, 276, 277, 277, 277, 277, 277, 277, 277, 277, 276, 277, 277, 277, 277, 276, 276, 277, 277, 277, 277, 277, 277, 277, 277, 277, 277, 286, 272, 272, 272, 272, 272, 272, 272, 272, 272, 272, 272, 272, 272, 272, 271, 271, 271, 271, 271, 271, 271, 271, 271, 271, 271, 271, 271, 271, 271, 269, 197, 196, 196, 196, 196, 224, 221, 221, 221, 221, 221, 220, 209, 210, 225, 227, 228, 228, 229, 230, 243, 251, 250, 250, 249, 249, 249, 250, 250, 249, 249, 249, 249, 246, 246, 246, 246, 246, 246, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 246, 246, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 245, 246, 246, 250, 261, 261, 262, 276, 276, 275, 275, 275, 275, 275, 275, 221, 209, 209, 209, 209, 235, 238, 238, 236, 237, 218, 236, 255, 241, 258, 258, 258, 258, 255, 266, 318, 318, 296, 273, 274, 275, 291, 274, 273, 274, 277, 278, 278, 278, 278, 277, 277, 276, 289, 290, 291, 293, 305, 304, 304, 304, 304, 304, 304, 293, 274, 272, 231, 231, 231, 231, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 226, 254, 274, 277, 277, 278, 277, 277, 277, 277, 277, 277, 277, 277, 277, 252, 225, 225, 225, 225, 225, 261, 252, 252, 252, 252, 252, 252, 242, 256, 259, 262, 262, 262, 264, 281, 283, 282, 282, 282, 282, 281, 280, 282, 282, 281, 281, 278, 277, 277, 276, 276, 276, 276, 276, 277, 277, 277, 277, 277, 277, 277, 277, 277, 276, 276, 277, 276, 277, 276, 277, 276, 277, 277, 277, 277, 277, 277, 277, 276, 276, 277, 276, 276, 276, 276, 276, 277, 277, 277, 277, 276, 276, 276, 276, 276, 276, 276, 276, 276, 277, 277, 278, 292, 292, 293, 307, 307, 306, 306, 307, 307, 306, 306, 251, 251, 251, 251, 246, 240, 241, 241, 240, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236",1)